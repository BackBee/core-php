window.auth = window.auth || {};
window.auth.providers = {
{% for provider, config in providers %}"{{ provider }}":{"enabled":true{{ (config['fa-icon'] is defined ? ',"fa-icon":"' ~ config['fa-icon'] ~ '"' : '')|raw }}},{% endfor %}
};
window.auth.entryPoint = "{{ entrypoint }}";

window.addEventListener(
    'message',
    function(e) {
        var origin = e.origin || e.originalEvent.origin,
            data = e.data;

        if (0 !== window.auth.entryPoint.indexOf(origin)) {
            return;
        }

        if (0 === window.auth.entryPoint.indexOf(origin) && data.key && data.signature) {
            var state = {};

            state[window.auth.HEADER_API_KEY] = data.key;
            state[window.auth.HEADER_API_SIGNATURE] = data.signature;

            window.auth.object.persistToSession(state);

            $.ajax({
              url: '/social/authenticate',
              type: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'X-API-SIGNATURE': data.signature,
                'X-API-KEY': data.key,
              }
            }).done(function (a, b) {
                window.location.reload();
            });
        } else {
            window.auth.object.showForm(data);
        }
    },
    false
);
